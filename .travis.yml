# http://about.travis-ci.org/docs/user/ci-environment/
# http://about.travis-ci.org/docs/user/build-configuration/
# Travis uses Ubuntu 64 12.04

language: python
python:
    # - "2.6" enable it by specify packages in setup.py and test it
    - "2.7" 
compiler:
    - gcc

install: 
    # cffi deps
    - sudo apt-get install python-dev libffi-dev  
    - pip install -q cffi --use-mirrors
    # ATLAS matrix library
    - sudo apt-get install libatlas3gf-base libblas-dev libatlas-dev libblas-dev libblas3gf
    - pushd /usr/include && sudo ln -s atlas/*.h . ; popd  # hack how to make available clapack.h FIXME failing cblas.h exists
    - ls -al /usr/include
    - ls -al /usr/lib
    - dpkg -l | grep 'blas\|lap'
    # OpenBLAS long lasting alternative with build
    # - pushd tools && sudo apt-get install gfortran && make openblas ; popd  # make opeblas returns 2?
    # Openfst
    - pushd tools && make openfst_tgt && popd
    # Configure with OpenBLAS
    # - pushd src && ./configure  --openblas-root=`pwd`/../tools/OpenBLAS/install --shared && popd 
    # Configure with ATLAS (default)
    - pushd src && ./configure --atlas-root=/usr --shared && popd 
    - pushd src && make depend 2>/dev/null >/dev/null && popd
    - pushd src && make && popd

script:          
    - pushd src && make test && popd
    - pushd src/dec-wrap && make depend && make && make test && popd
    - pushd src/pykaldi && python setup.py nosetests  # currently it will fail because of audio -> need get rid of makefile
